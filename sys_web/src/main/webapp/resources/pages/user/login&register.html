<!DOCTYPE HTML>
<html>
<head>
    <title>用户登录注册</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../../css/user/main.css">
    <link href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <script src="../../js/public/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/ajlkn/skel@3.0.1/dist/skel.min.js"></script>
    <script src="../../js/user/util.js"></script>
    <script src="../../js/user/main.js"></script>

</head>
<body>
<div id="wrapper">
    <input type="hidden" id="successLogin">
    <header id="header">
        <div class="logo">
            <span class="icon fa-rocket"></span>
        </div>
        <div class="content">
            <div class="inner">
                <h1>我是人间惆怅客，知君何事泪纵横</h1>
                <p style="float: right;font-size: 20px">——纳兰性德《浣溪沙》</p>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="#1">简介</a></li>
                <li><a href="#2">登录</a></li>
                <!-- <li><a href="/auth/register">注册</a></li>-->
                <li><a href="#3">注册</a></li>
            </ul>
        </nav>
    </header>
    <div id="main">
        <article id="1">
            <h2 class="major">简介</h2>
            <p>个人向网络平台</p>
        </article>
        <article id="2" style="display: none;">
            <h2 class="major">登录</h2>
            <form method="post" action="javascript:void(0);">
                <div class="field half first">
                    <label for="username1">用户名    <span class="glyphicon glyphicon-exclamation-sign loginSpan" aria-hidden="true" style="display:none" ></span>
                        <span class="sr-only loginSpan" style="display:none"><strong><font color="red">用户名不存在！</font></strong></span></label>
                    <input type="text" name="Email" id="username1">
                </div>
                <div class="field half">
                    <label for="pwd2">密码</label>
                    <input type="password" name="Password" id="pwd2">
                </div>
                <ul class="actions">
                    <li><input id="login2" type="submit" value="登录" class="special"></li>
                    <li><input type="reset" value="清空"></li>
                </ul>
                <br>
                <div class="field half first">
                    <input value="week" id="remember_me" name="remember_me" type="checkbox" checked="">
                    <label for="remember_me">记住我</label>
                </div>
            </form>

            <br>
            <div id="result" role="dialog">
                <p color="" class="h5 margin-top-sm text-black-hint" id="msg"></p>
            </div>
            <div class="close">Close</div></article>
        <article id="3" style="display: none;">
            <h2 class="major">注册></h2>
            <form method="post" action="javascript:void(0);">
                <div class="field half first">
                    <label for="username2">用户名   <span class="glyphicon glyphicon-exclamation-sign registerSpan" aria-hidden="true" style="display:none" ></span>
                        <span class="sr-only registerSpan" style="display:none"><strong><font color="red">用户名已存在！</font></strong></span>
                    </label>
                    <input type="text" name="username" id="username2">
                </div>
                <div class="field half">
                    <label for="nickname">姓名</label>
                    <input type="text" name="nickname" id="nickname">
                </div>
                <div class="field half first">
                    <label for="pwd3">密码</label>
                    <input type="password" name="password" id="pwd3">
                </div>
                <div class="field half">
                    <label for="phone">手机号</label>
                    <input type="text" name="phone" id="phone">
                </div>
                <div class="field half first">
                    <label for="alipay">支付宝</label>
                    <input type="text" name="alipay" id="alipay">
                </div>
                <div class="field half">
                    <label for="id_card">身份证</label>
                    <input type="text" name="id_card" id="id_card">
                </div>
                <div class="field half first">
                    <label for="sex">性别</label>
                    <input type="text" name="sex" id="sex">
                </div>
                <div class="field half">
                    <label for="age">年龄</label>
                    <input type="text" name="age" id="age">
                </div>
                <div class="field half first">
                    <label for="email">邮箱</label>
                    <input type="text" name="email" id="email">
                </div>
                <div class="field half">
                    <label for="address">地址</label>
                    <input type="text" name="address" id="address">
                </div>
                <ul class="actions">
                    <li><input id="login3" type="submit" value="注册" class="special"></li>
                    <li><input type="reset" value="清空"></li>
                </ul>
            </form>


            <div class="close">Close</div></article>
    </div>

    <footer id="footer">
        <p class="copyright"><a href="../library/login.html">图书馆登录</a></p>
    </footer>

</div>

<div id="bg"></div>
</body>

<script>
    $(function () {
        /*登录时验证用户名是否存在*/
        $("#username1").blur(function () {
            var username1 = document.getElementById("username1");
            $.ajax({
                url:"/user/verifyUser",
                data:{username:username1.value},
                type:"post",
                dataType:"json",
                success:function (data) {
                    if(data == 0){
                        $(".loginSpan").attr("style","display:");
                    }else {
                        $(".loginSpan").attr("style","display:none");
                    }
                }
            })
        });
        /*注册时验证用户名是否存在*/
        $("#username2").blur(function () {
            var username2 = document.getElementById("username2");
            $.ajax({
                url:"/user/verifyUser",
                data:{username:username2.value},
                type:"post",
                dataType:"json",
                success:function (data) {
                    if(data == 0){
                        $(".registerSpan").attr("style","display:none");
                    }else {
                        $(".registerSpan").attr("style","display:");
                    }
                }
            })
        });
        /*确认注册*/
        $("#login3").click(function () {
            /*private Integer userId;
              private String nickname;
              private String userSex;
              private String userAddress;
              private String userPhone;
              private Integer userAge;
              private String userEmail;
              private String userAlipay;
              private String userIdCard;*/
            var username = document.getElementById("username2");
            var nickname = document.getElementById("nickname");
            var userPwd = document.getElementById("pwd3");
            var userEmail = document.getElementById("email");
            var userAddress = document.getElementById("address");
            var userSex = document.getElementById("sex");
            var userAlipay = document.getElementById("alipay");
            var userPhone = document.getElementById("phone");
            var userAge = document.getElementById("age");
            var userIdCard = document.getElementById("id_card");
            $.ajax({
                url:"/user/register",
                data:{'username':username.value,'nickname':nickname.value,'userPwd':userPwd.value,'userEmail':userEmail.value,
                    'userPhone':userPhone.value,'userSex':userSex.value,'userAddress':userAddress.value,'userAlipay':userAlipay.value,
                    'userAge':userAge.value,'userIdCard':userIdCard.value},
                dataType:"json",
                type:"post",
                success:function (data) {
                    alert("注册成功！请登录！");
                }
            })
        });

        /*确定登录*/
        $("#login2").click(function () {
            var username1 = document.getElementById("username1");
            var pwd2 = document.getElementById("pwd2");
            $.ajax({
                url:"/library_online/user/"+username1.value+"/"+pwd2.value,
                type:"GET",
                dataType:"json",
                success:function (data) {
                    if(data.code === 400){
                        $("#pwd2").val("");
                        alert(data.message);
                    }
                    else {
                        window.location.href="userIndex.html";
                    }
                }
            })
        })


    });

</script>
<style>
    .sr-only{
        width:120px;
        overflow: visible;
        clip:auto;
    }
</style>
</html>
